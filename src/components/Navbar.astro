---
import { ArrowRight, Home, User, Briefcase, Code, Mail } from '@lucide/astro';
---

<!-- Top Brand Header -->
<header class="fixed top-0 w-full z-[100] px-4 md:px-6 py-4 md:py-6 pointer-events-none flex justify-center">
    <div class="w-full max-w-4xl flex items-center justify-between pointer-events-auto">
        <!-- Brand Logo Container -->
        <div class="flex items-center justify-between bg-white/80 backdrop-blur-xl border border-slate-200/60 px-5 py-2.5 rounded-[24px] shadow-[0_8px_30px_rgb(0,0,0,0.04)]">
            <div class="flex items-center gap-3 group cursor-pointer">
                <div class="w-[2.5px] h-7 bg-indigo-600 rounded-full"></div>
                <div class="flex flex-col leading-tight">
                    <h1 class="font-black text-sm md:text-base font-outfit text-slate-900 tracking-tight">
                        Muhammad <span class="text-indigo-600">.</span> Yusuf
                    </h1>
                    <span class="text-[8px] font-black text-slate-400 uppercase tracking-[0.15em]">Fullstack Engineer</span>
                </div>
            </div>

            <!-- Desktop Navigation -->
            <ul class="hidden lg:flex items-center gap-8 text-[12px] font-bold text-slate-600 ml-12">
                <li><a href="#home" class="nav-link hover:text-indigo-600 transition-colors" data-en="Home" data-id="Beranda">Home</a></li>
                <li><a href="#about" class="nav-link hover:text-indigo-600 transition-colors" data-en="About" data-id="Tentang">About</a></li>
                <li><a href="#portfolio" class="nav-link hover:text-indigo-600 transition-colors" data-en="Projects" data-id="Proyek">Projects</a></li>
                <li><a href="#skills" class="nav-link hover:text-indigo-600 transition-colors" data-en="Skills" data-id="Keahlian">Skills</a></li>
                <li><a href="#contact" class="nav-link hover:text-indigo-600 transition-colors" data-en="Contact" data-id="Kontak">Contact</a></li>
            </ul>

            <div class="hidden lg:flex items-center gap-4 ml-8">
                <div class="w-[1px] h-5 bg-slate-200"></div>
                <button class="group flex items-center gap-2 bg-[#234E5E] hover:bg-slate-900 text-white px-4 py-1.5 rounded-xl text-[12px] font-extrabold transition-all duration-300 active:scale-95">
                    <span data-en="Hire Me" data-id="Hubungi Saya">Hire Me</span>
                    <ArrowRight size={14} class="group-hover:translate-x-1 transition-transform" />
                </button>
            </div>
        </div>

        <!-- Language Switcher -->
        <div class="flex items-center bg-white/80 backdrop-blur-xl border border-slate-200/60 p-1 rounded-xl shadow-[0_8px_30px_rgb(0,0,0,0.04)] lang-switcher">
            <button data-lang="en" class="lang-btn bg-[#234E5E] text-white px-2.5 py-1 rounded-lg text-[10px] font-black uppercase tracking-wider transition-all">EN</button>
            <button data-lang="id" class="lang-btn text-slate-400 px-2.5 py-1 rounded-lg text-[10px] font-black uppercase tracking-wider hover:text-slate-600 transition-all">ID</button>
        </div>
    </div>
</header>

<!-- Mobile Bottom Navigation -->
<nav class="fixed bottom-0 left-0 w-full z-[100] lg:hidden bg-[#1E1E26] border-t border-white/5 shadow-[0_-15px_40px_rgba(0,0,0,0.45)]">
    <div class="flex items-center h-20 px-2">
        <div class="flex w-full h-full">
            {['home', 'about', 'portfolio', 'skills', 'contact'].map((id, index) => (
                <a 
                    href={`#${id}`} 
                    class="mobile-nav-item flex-1 flex flex-col items-center justify-center relative h-full transition-all duration-300 group"
                    data-index={index}
                >
                    <!-- Per-item Active Block (Circle) -->
                    <div class="active-bg absolute w-14 h-14 bg-indigo-500 rounded-full opacity-0 scale-50 transition-all duration-500 shadow-[0_0_20px_rgba(79,70,229,0.4)]"></div>
                    
                    <div class="icon-container relative z-10 flex items-center justify-center transition-all duration-500">
                        {index === 0 && <Home size={22} class="nav-icon" />}
                        {index === 1 && <User size={22} class="nav-icon" />}
                        {index === 2 && <Briefcase size={22} class="nav-icon" />}
                        {index === 3 && <Code size={22} class="nav-icon" />}
                        {index === 4 && <Mail size={22} class="nav-icon" />}
                    </div>
                    
                    <span 
                        class="nav-label text-[9px] font-black text-white/40 uppercase tracking-widest mt-1 transition-all duration-500 relative z-10" 
                        data-en={['Home', 'About', 'Projects', 'Skills', 'Contact'][index]} 
                        data-id={['Beranda', 'Tentang', 'Proyek', 'Keahlian', 'Kontak'][index]}
                    >
                        {['Home', 'About', 'Projects', 'Skills', 'Contact'][index]}
                    </span>
                </a>
            ))}
        </div>
    </div>
</nav>

<style>
    /* Styling for Non-Active state */
    .nav-icon {
        color: rgba(255, 255, 255, 0.4);
    }

    /* Active State Logic: Each item manages its own active elements */
    .mobile-nav-item.active .active-bg {
        opacity: 1;
        scale: 1;
    }

    .mobile-nav-item.active .nav-label {
        opacity: 0;
        visibility: hidden;
        transform: translateY(10px);
    }

    .mobile-nav-item.active .nav-icon {
        color: white;
        transform: scale(1.1);
    }

    /* Centering the icon in the middle of the nav-item when active */
    .mobile-nav-item.active .icon-container {
        transform: translateY(8px); /* Shift icon down to the absolute center of the h-20 bar */
    }

    @media (max-width: 1024px) {
        body { padding-bottom: 80px; }
    }
</style>

<script>
    const navItems = document.querySelectorAll('.mobile-nav-item');
    const langBtns = document.querySelectorAll('.lang-btn');

    function setActive(index: number) {
        navItems.forEach((item, i) => {
            if (i === index) {
                item.classList.add('active');
            } else {
                item.classList.remove('active');
            }
        });
    }

    navItems.forEach((item, index) => {
        item.addEventListener('click', () => {
            setActive(index);
        });
    });

    // Language switcher logic
    langBtns.forEach((btn) => {
        btn.addEventListener("click", () => {
            const lang = btn.getAttribute("data-lang");
            
            document.querySelectorAll(`.lang-btn`).forEach((b) => {
                const isSelected = b.getAttribute("data-lang") === lang;
                if (isSelected) {
                    b.classList.add("bg-[#234E5E]", "text-white");
                    b.classList.remove("text-slate-400");
                } else {
                    b.classList.remove("bg-[#234E5E]", "text-white");
                    b.classList.add("text-slate-400");
                }
            });

            window.dispatchEvent(new CustomEvent("langchange", { detail: { lang } }));
            localStorage.setItem("preferred-lang", lang || "en");
        });
    });

    const savedLang = localStorage.getItem('preferred-lang') || 'en';
    const initialBtn = document.querySelector(`.lang-btn[data-lang="${savedLang}"]`);
    if (initialBtn instanceof HTMLElement) initialBtn.click();

    // Scroll Spy
    window.addEventListener('scroll', () => {
        const sections = ['home', 'about', 'portfolio', 'skills', 'contact'];
        const scrollPos = window.scrollY + 250;

        sections.forEach((id, index) => {
            const section = document.getElementById(id);
            if (section && scrollPos >= section.offsetTop && scrollPos < (section.offsetTop + section.offsetHeight)) {
                setActive(index);
                document.querySelectorAll('.nav-link').forEach((link, lIndex) => {
                    if (lIndex === index) link.classList.add('text-indigo-600');
                    else link.classList.remove('text-indigo-600');
                });
            }
        });
    });

    // Initial Active
    setActive(0);
</script>
